name: Dropbox
description: Upload files to Dropbox

inputs:
  files-to-upload:
    description: A list of files to upload to dropbox
    required: true

runs:
  using: composite
  steps:
    - name: checkout source
      uses: actions/checkout@v4

    - name: Set up Dropbox
      run: |
        echo "CONFIGFILE_VERSION=$CONFIGFILE_VERSION" > ~/.dropbox_uploader
        echo "OAUTH_APP_KEY=$OAUTH_APP_KEY" >> ~/.dropbox_uploader
        echo "OAUTH_APP_SECRET=$OAUTH_APP_SECRET" >> ~/.dropbox_uploader
        echo "OAUTH_REFRESH_TOKEN=$OAUTH_REFRESH_TOKEN" >> ~/.dropbox_uploader
      env:
        CONFIGFILE_VERSION: ${{secrets.CONFIGFILE_VERSION}}
        OAUTH_APP_KEY: ${{secrets.OAUTH_APP_KEY}}
        OAUTH_APP_SECRET: ${{secrets.OAUTH_APP_SECRET}}
        OAUTH_REFRESH_TOKEN: ${{secrets.OAUTH_REFRESH_TOKEN}}

    - name: Retrieve Dropbox uploader script
      run: |
        curl "https://raw.githubusercontent.com/andreafabrizi/\
        Dropbox-Uploader/master/dropbox_uploader.sh" \
        -o dropbox_uploader.sh
        chmod +x dropbox_uploader.sh

    - name: Upload PDF
      run: |
        for file in ${{ inputs.files-to-upload }}; do \
        echo $file; \
        ./dropbox_uploader.sh upload $file $file; \
        done
